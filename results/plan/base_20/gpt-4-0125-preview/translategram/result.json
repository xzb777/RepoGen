{
    "implementation": [
        {
            "key_id": 0,
            "fqn": "translategram/translategram/translator_services.py/MtranslateTranslatorService/__init__",
            "imports": [
                "from mtranslate import translate"
            ],
            "code": "def __init__(self):\n    self.service = translate"
        },
        {
            "key_id": 1,
            "fqn": "translategram/translategram/cache.py/PickleCache/__init__",
            "imports": [
                "import pickle",
                "from pathlib import Path"
            ],
            "code": "def __init__(self, obj: object, filename: str = 'translation.data') -> None:\n    self.obj = obj\n    self.filename = filename\n    self.filepath = Path(filename)\n    if not self.filepath.exists():\n        with self.filepath.open('wb') as file:\n            pickle.dump(obj, file)\n\ndef __del__(self):\n    with self.filepath.open('wb') as file:\n        pickle.dump(self.obj, file)"
        },
        {
            "key_id": 3,
            "fqn": "translategram/translategram/translator.py/Translator/__init__",
            "imports": [
                "from typing import Type, Union",
                "from .translator_services import TranslatorService",
                "from .cache import Cache"
            ],
            "code": "def __init__(self, translator_service: TranslatorService, cache_system: Union[Type[Cache], None] = None) -> None:\n    self.translator_service = translator_service\n    self.cache_system = cache_system"
        },
        {
            "key_id": 6,
            "fqn": "translategram/python_telegram_bot_translator/adapter.py/PythonTelegramBotAdapter/__init__",
            "imports": [
                "from typing import Type, Union",
                "from translategram.translategram.translator import Translator",
                "from translategram.translategram.translator_services import TranslatorService",
                "from translategram.translategram.cache import Cache"
            ],
            "code": "def __init__(self, translator_service: Type[TranslatorService], cache_system: Union[Type[Cache], None] = None) -> None:\n    self._translator_service = translator_service()\n    self._cache_system = cache_system\n\ndef handler_translator(self, message: str, source_lang: str = 'auto') -> str:\n    if self._cache_system:\n        cached_msg = self._cache_system.retrieve(message)\n        if cached_msg:\n            return cached_msg\n    translated_text = self._translator_service.translate(message, source_lang)\n    if self._cache_system:\n        self._cache_system.store(message, translated_text)\n    return translated_text"
        },
        {
            "key_id": 2,
            "fqn": "translategram/translategram/cache.py/PickleCache/__del__",
            "imports": [
                "import pickle",
                "from pathlib import Path"
            ],
            "code": "def __init__(self, obj: object, filename: str = 'translation.data') -> None:\n    self.obj = obj\n    self.filename = filename\n    self.filepath = Path(filename)\n    if not self.filepath.exists():\n        with self.filepath.open('wb') as file:\n            pickle.dump(obj, file)\n\ndef __del__(self):\n    with self.filepath.open('wb') as file:\n        pickle.dump(self.obj, file)"
        },
        {
            "key_id": 4,
            "fqn": "translategram/translategram/translator.py/Translator/handler_translator",
            "imports": [
                "from typing import Callable, Coroutine, Any, TypeVar",
                "from translategram.translategram.translator_services import TranslatorService",
                "from translategram.translategram.cache import Cache"
            ],
            "code": "def __init__(self, translator_service: TranslatorService, cache_system: Union[Type[Cache], None] = None) -> None:\n    self.translator_service = translator_service\n    self.cache_system = cache_system\n\ndef handler_translator(self, message: str, source_lang: str) -> Callable[[Callable[..., object]], Callable[[Any, Any, str], Coroutine[Any, Any, Any]]]:\n    async def wrapper(func: Callable[..., object], *args, **kwargs) -> Coroutine[Any, Any, Any]:\n        translated_message = await self.translator_service.translate(message, source_lang)\n        if self.cache_system is not None:\n            await self.cache_system.store(message, translated_message)\n        return await func(*args, **kwargs, message=translated_message)\n    return wrapper"
        },
        {
            "key_id": 5,
            "fqn": "translategram/translategram/translator.py/Translator/dynamic_handler_translator",
            "imports": [
                "from typing import Callable, Coroutine, Any, TypeVar",
                "from translategram.translategram.translator_services import TranslatorService",
                "from translategram.translategram.cache import Cache"
            ],
            "code": "def __init__(self, translator_service: TranslatorService, cache_system: Union[Type[Cache], None] = None) -> None:\n    self.translator_service = translator_service\n    self.cache_system = cache_system\n\ndef dynamic_handler_translator(self, message_func: Callable[[str, Any], str], source_lang: str = 'auto') -> Callable[[Callable[..., object]], Callable[[Any, Any], Coroutine[Any, Any, Any]]]:\n    async def wrapper(func: Callable[..., object], *args, **kwargs) -> Coroutine[Any, Any, Any]:\n        message = message_func(*args, **kwargs)\n        translated_message = await self.translator_service.translate(message, source_lang)\n        if self.cache_system is not None:\n            await self.cache_system.store(message, translated_message)\n        return await func(*args, **kwargs, message=translated_message)\n    return wrapper"
        },
        {
            "key_id": 7,
            "fqn": "translategram/python_telegram_bot_translator/adapter.py/PythonTelegramBotAdapter/handler_translator",
            "imports": [
                "from typing import Callable, Coroutine, Any",
                "from translategram.translategram.translator_services import TranslatorService",
                "from translategram.translategram.cache import Cache",
                "from telegram import Update"
            ],
            "code": "def __init__(self, translator_service: Type[TranslatorService], cache_system: Union[Type[Cache], None] = None) -> None:\n    self._translator_service = translator_service()\n    self._cache_system = cache_system\n\ndef handler_translator(self, message: str, source_lang: str = 'auto') -> Callable[[Callable[[Any, Any, str], object]], Callable[[Any, Any, str], Coroutine[Any, Any, Any]]]:\n    async def wrapper(update: Update, context: Any, user_message: str) -> None:\n        user_lang = update.effective_user.language_code if update.effective_user else 'en'\n        if self._cache_system:\n            cached_msg = await self._cache_system.retrieve(user_message + '_' + user_lang)\n            if cached_msg:\n                await context.bot.send_message(chat_id=update.effective_chat.id, text=cached_msg)\n                return\n        translated_text = await self._translator_service.translate(user_message, target_language=user_lang, source_language=source_lang)\n        if self._cache_system:\n            await self._cache_system.store(user_message + '_' + user_lang, translated_text)\n        await context.bot.send_message(chat_id=update.effective_chat.id, text=translated_text)\n    return wrapper"
        },
        {
            "key_id": 8,
            "fqn": "translategram/python_telegram_bot_translator/adapter.py/PythonTelegramBotAdapter/dynamic_handler_translator",
            "imports": [
                "from typing import Callable, Coroutine, Any",
                "from translategram.translategram.translator_services import TranslatorService",
                "from translategram.translategram.cache import Cache",
                "from telegram import Update"
            ],
            "code": "def __init__(self, translator_service: Type[TranslatorService], cache_system: Union[Type[Cache], None] = None) -> None:\n    self._translator_service = translator_service()\n    self._cache_system = cache_system\n\ndef dynamic_handler_translator(self, message_func: Callable[[str, Any], str], source_lang: str = 'auto') -> Callable[[Callable[..., object]], Callable[[Any, Any], Coroutine[Any, Any, Any]]]:\n    async def wrapper(update: Update, context: Any) -> None:\n        user_lang = update.effective_user.language_code if update.effective_user else 'en'\n        original_message = message_func(update, context)\n        if self._cache_system:\n            cached_msg = await self._cache_system.retrieve(original_message + '_' + user_lang)\n            if cached_msg:\n                await context.bot.send_message(chat_id=update.effective_chat.id, text=cached_msg)\n                return\n        translated_text = await self._translator_service.translate(original_message, target_language=user_lang, source_language=source_lang)\n        if self._cache_system:\n            await self._cache_system.store(original_message + '_' + user_lang, translated_text)\n        await context.bot.send_message(chat_id=update.effective_chat.id, text=translated_text)\n    return wrapper"
        }
    ]
}